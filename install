#!/bin/bash
echo "--> Install script v1.1"

#Generating piget directory
mkdir /opt/piget
mkdir /opt/user

#User data directory
mkdir /opt/user/scripts
mkdir /opt/user/config
mkdir /opt/user/data
mkdir /opt/user/state

#We remove core functions if previously installed
rm -rf /opt/piget/core

#Cloning core scripts repository
git clone https://github.com/pigetnet/core /opt/piget/core

#Create link
if [ -L /net ];then
	rm /net
fi

if [ -L /pi ];then
	rm /pi
fi

if [ -L /show ];then
	rm /show
fi

if [ -L /string ];then
	rm /string
fi

if [ -L /system ];then
	rm /system
fi

if [ -L /do ];then
	rm /do
fi

if [ -L /user ];then
	rm /user
fi

ln -sv /opt/piget/core/net /net
ln -sv /opt/piget/core/pi /pi
ln -sv /opt/piget/core/show /show
ln -sv /opt/piget/core/string /string
ln -sv /opt/piget/core/system /system
ln -sv /opt/piget/ /do
ln -sv /opt/user/ /user

/system/modifyBashStartup core
pip install tzupdate
tzupdate
echo "Updating package"
apt-get update

/show/description "PIGET WAS SUCCESFULLY INSTALLED"

if [ -f /boot/piget/scripts/postinstall.sh ]
	then
	/show/description "POST INSTALL SCRIPT FOUNDED"
	chmod +x /boot/piget/scripts/postinstall.sh
	/boot/piget/scripts/postinstall.sh
fi

